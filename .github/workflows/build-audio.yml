name: Build Audio-Only 16KB AAR
on:
  workflow_dispatch: # Bu satır, butona basarak manuel başlatmanızı sağlar
jobs:
  build:
    name: Build FFmpeg-Kit (Audio Only)
    runs-on: ubuntu-latest
    steps:
      - name: Depoyu Çek (Checkout)
        uses: actions/checkout@v4
      - name: Gerekli Araçları Yükle
        run: |
          sudo apt-get update
          sudo apt-get install -y nasm yasm build-essential pkg-config autoconf automake libtool git gettext cmake
      # setup-android aksiyonu hata verdiği için kaldırdık.
      # GitHub Runner'larında NDK zaten yüklü geliyor.
      
      - name: FFmpeg Ayarlarını Yamala (Video Bileşenlerini Kapat)
        run: |
          # Bu komut ffmpeg.sh dosyasını düzenleyerek video ile ilgili her şeyi kapatır.
          # Sadece ses (AAC, MP3, DTS, TrueHD vb.) açık kalır.
          sed -i 's/--disable-autodetect/--disable-video --disable-encoders --enable-encoder=aac --disable-decoders --enable-decoder=aac --enable-decoder=mp3 --enable-decoder=flac --enable-decoder=opus --enable-decoder=vorbis --enable-decoder=dca --enable-decoder=truehd --enable-decoder=ac3 --enable-decoder=eac3 --enable-decoder=pcm_s16le --disable-muxers --enable-muxer=mp4 --enable-muxer=matroska --disable-demuxers --enable-demuxer=matroska --enable-demuxer=mov --enable-demuxer=aac --enable-demuxer=mp3 --enable-demuxer=flac --enable-demuxer=ogg --enable-demuxer=wav --enable-demuxer=dts --enable-demuxer=ac3 --enable-demuxer=eac3 --disable-doc --disable-devices --disable-postproc --disable-avfilter --enable-avfilter=aresample --disable-swscale --disable-network --disable-autodetect/' scripts/android/ffmpeg.sh
          
          echo "Yama uygulandı. Kontrol ediliyor..."
          grep "disable-video" scripts/android/ffmpeg.sh
      - name: FFmpeg-Kit Derlemesini Başlat
        env:
          ANDROID_SDK_ROOT: ${{ env.ANDROID_SDK_ROOT }}
          ANDROID_NDK_ROOT: ${{ env.ANDROID_NDK_HOME }}
        run: |
          chmod +x android.sh
          # Sadece gerekli ses kütüphanelerini etkinleştirerek derlemeyi başlat
          ./android.sh --enable-libmp3lame --enable-libopus --enable-libvorbis --enable-libsoxr --enable-libopencore-amr --enable-libshine --enable-libtwolame --enable-libspeex --force
      - name: AAR Dosyasını Yükle (Upload Artifact)
        uses: actions/upload-artifact@v4
        with:
          name: ffmpeg-kit-audio-16kb
          path: prebuilt/android-aar/ffmpeg-kit/ffmpeg-kit.aar
